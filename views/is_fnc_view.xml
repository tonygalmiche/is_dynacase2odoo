<?xml version="1.0" encoding="utf-8"?>
<odoo>
	<!-- Form view -->
	<record id="view_is_fnc_form" model="ir.ui.view">
		<field name="name">is.fnc.form</field>
		<field name="model">is.fnc</field>
		<field name="arch" type="xml">
            <form>
                <header>
                    <field name="dynacase_id" invisible="1"/>
                    <button 
                        string="Dynacase" name="lien_vers_dynacase_action"
                        type="object" class="btn btn-info"
                        attrs="{'invisible': [('dynacase_id', '=', 0)]}"
                        groups="base.group_system"
                    />
                </header>
                <sheet>
                    <field name="active" invisible="1"/>
                    <widget name="web_ribbon" title="Archivé" bg_color="bg-danger" attrs="{'invisible': [('active', '=', True)]}"/>
					<notebook>
						<page string="Description">
                            <group>
                                <group>
                                    <field name="site_id" required="1"/>
                                    <field name="type_non_conformite" required="1"/>
                                    <field name="num_non_conformite" required="1"/>
                                    <field name="date_detection" required="1"/>
                                    <field name="client_id" required="1"/>
                                    <field name="client_autre" attrs="{'invisible':[('client_autre','=',False)]}"/>
                                    <field name="num_reclamation"/>
                                    <field name="contact_client"/>
                                    <field name="mail_commercial"/>
                                </group>
                            </group>
                            <group string="Liste des produits concernés">
                                <field name="produit_ids" context="{'default_fnc_id': active_id}" nolabel="1" colspan="2">
                                    <tree editable="bottom">
                                        <field name="article_id"  optional="show"/>
                                        <field name="designation" optional="hide"/>
                                        <field name="moule_id"    optional="show"/>
                                        <field name="dossierf_id" optional="show"/>
                                        <field name="project_id"  optional="show"/>
                                        <field name="ref_client"  optional="show"/>
                                        <field name="prix_vente"  optional="show"/>
                                        <field name="qt_non_conforme" optional="show"/>
                                        <field name="qt_retournee" optional="show"/>
                                        <field name="qt_detruite" optional="show"/>
                                    </tree>
                                </field>
                            </group>
                            <group>
                                <group>
                                    <field name="total_non_conforme"/>
                                    <field name="description_probleme"/>
                                    <field name="type_defaut"/>
                                    <field name="tracabilite"/>
                                    <field name="reclamation_recurrente"/>
                                </group>
                            </group>
                        </page>
						<page string="Action immédiate">
							<group>
								<group>
									<field name="bl_retour"/>
								</group>
                            </group>
                            <group string="Actions">
                                <field name="action_ids" context="{'default_fnc_id': active_id}" nolabel="1" colspan="2" >
                                    <tree editable="bottom">
                                        <field name="tri_stock"/>
                                        <field name="action_stock"/>
                                        <field name="responsable_tri"/>
                                        <field name="date_tri"/>
                                        <field name="nb_non_conforme"/>
                                        <field name="cout_tri"/>
                                    </tree>
                                </field>
                            </group>
                            <group string="Actions curatives">
                                <field name="action_curative_ids" context="{'default_fnc_id': active_id}" nolabel="1" colspan="2" >
                                    <tree editable="bottom">
                                        <field name="cur_action"/>
                                        <field name="cur_responsable"/>
                                        <field name="cur_delai"/>
                                        <field name="cur_date"/>
                                    </tree>
                                </field>
                            </group>
							<group>
								<group>
									<field name="reponse"/>
								</group>
                            </group>
						</page>
						<page string="Analyse de la non-conformité">
							<field name="cause_ids" context="{'default_fnc_id': active_id}" nolabel="1" colspan="2">
								<tree editable="bottom">
									<field name="cause"/>
									<field name="type"/>
									<field name="type_cause"/>
									<field name="contribution"/>
								</tree>
							</field>
                            <group>
                                <group>
                                    <field name="equipe"/>
                                    <field name="operateur"/>
                                    <field name="presse_id"/>
                                    <field name="origine_defaut"/>
                                    <field name="decision"/>
                                    <field name="date_reponse_4d"/>
                                </group>
                            </group>
						</page>
						<page string="Plan d'actions">
                            <group>
                                <field name="id" invisible="1"/>
                            </group>
                            <group string="Actions correctives">
                                <field name="action_corrective_ids" context="{'default_fnc_id': active_id}" nolabel="1" colspan="2">
                                    <tree editable="bottom">
                                        <field name="cor_action"/>
                                        <field name="cor_responsable"/>
                                        <field name="cor_delai"/>
                                        <field name="cor_date"/>
                                    </tree>
                                </field>
                            </group>
                            <group string="Actions préventives">
                                <field name="action_preventive_ids" context="{'default_fnc_id': active_id}" nolabel="1" colspan="2">
                                    <tree editable="bottom">
                                        <field name="pre_action"/>
                                        <field name="pre_responsable"/>
                                        <field name="pre_delai"/>
                                        <field name="pre_date"/>
                                    </tree>
                                </field>
                            </group>


                            <group string="Mesure de l'efficacité des actions">
                                <field name="action_efficacite_ids" context="{'default_fnc_id': active_id}" nolabel="1" colspan="2">
                                    <tree editable="bottom">
                                        <field name="eff_action"/>
                                        <field name="eff_responsable"/>
                                        <field name="eff_delai"/>
                                        <field name="eff_date"/>
                                        <field name="eff_conclusion"/>
                                    </tree>
                                </field>
                            </group>                            
                            <group>
                                <field name="date_8d"/>
                            </group>
                            <group string="8D et modification documentation">
                                <group>
                                    <field name="doc_amdec"/>
                                    <field name="doc_plan_surveillance"/>
                                    <field name="doc_moyen_controle"/>
                                    <field name="doc_mode_operatoire"/>
                                    <field name="doc_plans"/>
                                    <field name="doc_autres"/>
                                    <field name="date_cloture"/>
                                </group>
                            </group>
						</page>
						<page string="Coûts">

                            <group>
                                <field name="id" invisible="1"/>
                            </group>


							<group string="Coût comptable (Service Financier)">
								<field name="avoir_ids" context="{'default_fnc_id': active_id}" nolabel="1" colspan="2">
									<tree editable="bottom">
										<field name="num_avoir"/>
										<field name="date_avoir"/>
										<field name="montant_avoir"/>
									</tree>
								</field>
							</group>
							<group>
								<group>
									<field name="total_avoir"/>
									<field name="date_bilan"/>
									<field name="situation_bilan"/>
								</group>
                            </group>
                            <group string="Autres coûts non qualité">
								<field name="autre_cout_ids" context="{'default_fnc_id': active_id}" nolabel="1" colspan="2">
									<tree editable="bottom">
										<field name="type_cout"/>
										<field name="montant"/>
									</tree>
								</field>
							</group>
                            <group>
								<group>
									<field name="cout_facture"/>
                                    <field name="cout_piece"/>
									<field name="cout_total_tri"/>
									<field name="total_autrecouts"/>
									<field name="cout_total"/>
									<field name="total_perte"/>
								</group>
							</group>
						</page>
                        <!-- 
						<page string="Action">
							<group>
								<group>
									<field name="nb_retournees"/>
									<field name="nb_detruites"/>
								</group>
							</group>
						</page> 
                        -->
					</notebook>
                </sheet>
                <div class="oe_chatter">
                    <field name="message_follower_ids"/>
                    <field name="activity_ids"/>
                    <field name="message_ids"/>
                </div>
            </form>
		</field>
	</record>

	<!-- Tree view -->
	<record id="view_is_fnc_tree" model="ir.ui.view">
		<field name="name">is.fnc.tree</field>
		<field name="model">is.fnc</field>
		<field name="arch" type="xml">
            <tree>
                <!-- Identification / description -->
                <field name="site_id" optional="show"/>
                <field name="num_non_conformite" optional="show"/>
                <field name="type_non_conformite" optional="show"/>
                <field name="date_detection" optional="show"/>
                <field name="client_id" optional="show" widget="many2one_clickable"/>
                <field name="client_autre" optional="hide"/>
                <field name="mail_commercial" optional="hide"/>
                <field name="num_reclamation" optional="show"/>
                <field name="contact_client" optional="hide"/>
                <field name="total_non_conforme" optional="show"/>
                <field name="description_probleme" optional="show"/>
                <field name="type_defaut" optional="show"/>
                <field name="tracabilite" optional="hide"/>
                <field name="reclamation_recurrente" optional="hide"/>

                <!-- Action immédiate -->
                <field name="nb_retournees" optional="hide"/>
                <field name="nb_detruites" optional="hide"/>
                <field name="bl_retour" optional="hide"/>
                <field name="reponse" optional="hide"/>

                <!-- Analyse -->
                <field name="equipe" optional="hide"/>
                <field name="operateur" optional="hide"/>
                <field name="presse_id" optional="hide"/>
                <field name="origine_defaut" optional="hide"/>
                <field name="decision" optional="hide"/>
                <field name="date_reponse_4d" optional="hide"/>

                <!-- Plan d'action / 8D -->
                <field name="date_8d" optional="hide"/>
                <field name="doc_amdec" optional="hide"/>
                <field name="doc_plan_surveillance" optional="hide"/>
                <field name="doc_moyen_controle" optional="hide"/>
                <field name="doc_mode_operatoire" optional="hide"/>
                <field name="doc_plans" optional="hide"/>
                <field name="doc_autres" optional="hide"/>
                <field name="date_cloture" optional="hide"/>

                <!-- Coûts / Bilan -->
                <field name="total_avoir" optional="hide"/>
                <field name="date_bilan" optional="hide"/>
                <field name="situation_bilan" optional="hide"/>
                <field name="cout_piece" optional="hide"/>
                <field name="cout_total_tri" optional="hide"/>
                <field name="total_autrecouts" optional="hide"/>
                <field name="cout_total" optional="hide"/>
                <field name="cout_facture" optional="hide"/>
                <field name="total_perte" optional="hide"/>

                <button 
                    title="Dynacase" name="lien_vers_dynacase_action" type="object" icon="fa-file"
                    attrs="{'invisible': [('dynacase_id', '=', 0)]}"
                    groups="base.group_system"
                />
                <field name="dynacase_id" optional="hide" groups="base.group_system"/>

                <!-- Métadonnées -->
                <field name="create_date" optional="hide" string="Créé le"/>
                <field name="create_uid"  optional="hide" string="Créé par"/>
                <field name="write_date"  optional="hide" string="Modifié le"/>
                <field name="write_uid"   optional="hide" string="Modifié par"/>
            </tree>
		</field>
	</record>

	<!-- Search view -->
	<record id="view_is_fnc_search" model="ir.ui.view">
		<field name="name">is.fnc.search</field>
		<field name="model">is.fnc</field>
		<field name="arch" type="xml">
			<search>
				<field name="num_non_conformite"/>
				<field name="client_id"/>
				<field name="type_non_conformite"/>
				<field name="decision"/>
				<field name="date_detection"/>
				<field name="date_cloture"/>
				<separator/>
				<group expand="0" string="Grouper par">
					<filter string="Type" name="group_type" context="{'group_by':'type_non_conformite'}"/>
					<filter string="Client" name="group_client" context="{'group_by':'client_id'}"/>
					<filter string="Site" name="group_site" context="{'group_by':'site_id'}"/>
					<filter string="Décision" name="group_decision" context="{'group_by':'decision'}"/>
				</group>
			</search>
		</field>
	</record>

	<!-- Action -->
	<record id="is_fnc_action" model="ir.actions.act_window">
		<field name="name">FNC</field>
		<field name="res_model">is.fnc</field>
		<field name="view_mode">tree,form</field>
	</record>

</odoo>
