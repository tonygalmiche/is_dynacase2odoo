<?xml version="1.0" encoding="utf-8"?>
<odoo>
    <data>

        <!-- is.ctrl.rcp.gamme -->
        <!-- <record id="is_ctrl_rcp_gamme_tree_view" model="ir.ui.view">
            <field name="name">is_ctrl_rcp_gamme_tree_view</field>
            <field name="model">is.ctrl.rcp.gamme</field>
            <field name="arch" type="xml">
                <tree>
                    <field name="dossier_article_id" optional="show" widget="many2one_clickable"/>
                    <field name="dossier_article" optional="hide"/>
                    <field name="responsable_id" optional="show"/>
                    <field name="date_fin_prevue" optional="show"/>
                    <field name="etat" widget="badge" optional="show"/>
                    <field name="piece_jointe_ids" widget="many2many_tags" optional="hide"/>
                    <field name="create_date" optional="hide" string="Créé le"/>
                    <field name="create_uid"  optional="hide" string="Créé par"/>
                    <field name="write_date"  optional="hide" string="Modifié le"/>
                    <field name="write_uid"   optional="hide" string="Modifié par"/>
                    <button 
                        title="Dynacase" name="lien_vers_dynacase_action" type="object" icon="fa-file" 
                        attrs="{'invisible': [('dynacase_id', '=', 0)]}"
                        groups="base.group_system"
                    />
                    <field name="dynacase_id" optional="hide" groups="base.group_system"/>
                </tree>
            </field>
        </record>
        <record id="is_ctrl_rcp_gamme_form_view" model="ir.ui.view">
            <field name="name">is_ctrl_rcp_gamme_form_view</field>
            <field name="model">is.ctrl.rcp.gamme</field>
            <field name="arch" type="xml">
                        <form string="Gamme Contrôle Réception">
                            <header>
                                <field name="dynacase_id" invisible="1"/>
                                <button 
                                    string="Dynacase" name="lien_vers_dynacase_action"
                                    type="object" class="btn btn-info"
                                    attrs="{'invisible': [('dynacase_id', '=', 0)]}"
                                    groups="base.group_system"
                                />
                            </header>
                            <sheet>
                                <field name="active" invisible="1"/>
                                <widget name="web_ribbon" title="Archivé" bg_color="bg-danger" attrs="{'invisible': [('active', '=', True)]}"/>
                        <group>
                            <group>
                                <field name="dossier_article_id" required="1"/>
                                <field name="dossier_article" attrs="{'invisible': [('dossier_article', '=', False)]}"/>
                                <field name="responsable_id"/>
                                <field name="date_fin_prevue"/>
                                <field name="etat"/>
                            </group>
                        </group>
                        <group string="Pièces jointes">
                            <field name="piece_jointe_ids" widget="many2many_binary" nolabel="1" colspan="2"/>
                        </group>
                        <group string="Contrôles">
                            <field name="controle_ids" context="{'default_gamme_id': active_id}" nolabel="1" colspan="2">
                                <tree editable="bottom">
                                    <field name="intitule_controle"/>
                                    <field name="tolerance_mini"/>
                                    <field name="tolerance_maxi"/>
                                </tree>
                                <form string="Contrôle">
                                    <group>
                                        <field name="intitule_controle"/>
                                        <field name="tolerance_mini"/>
                                        <field name="tolerance_maxi"/>
                                    </group>
                                </form>
                            </field>
                        </group>
                    </sheet>
                    <div class="oe_chatter">
                        <field name="message_follower_ids"/>
                        <field name="activity_ids"/>
                        <field name="message_ids"/>
                    </div>
                </form>
            </field>
        </record>
        <record id="is_ctrl_rcp_gamme_search_view" model="ir.ui.view">
            <field name="name">is_ctrl_rcp_gamme_search_view</field>
            <field name="model">is.ctrl.rcp.gamme</field>
            <field name="arch" type="xml">
                <search>
                    <field name="dossier_article_id" string="Code PG"/>
                    <field name="responsable_id"/>
                    <field name="date_fin_prevue"/>
                    <field name="etat"/>
                </search>
            </field>
        </record> -->


        <!-- is.ctrl.rcp.gamme.controle -->
        <record id="is_ctrl_rcp_gamme_controle_tree_view" model="ir.ui.view">
            <field name="name">is_ctrl_rcp_gamme_controle_tree_view</field>
            <field name="model">is.ctrl.rcp.gamme.controle</field>
            <field name="arch" type="xml">
                <tree>
                    <field name="doc_gamme_id" optional="show"/>
                    <field name="intitule_controle" optional="show"/>
                    <field name="tolerance_mini" optional="show"/>
                    <field name="tolerance_maxi" optional="show"/>
                </tree>
            </field>
        </record>
        <record id="is_ctrl_rcp_gamme_controle_form_view" model="ir.ui.view">
            <field name="name">is_ctrl_rcp_gamme_controle_form_view</field>
            <field name="model">is.ctrl.rcp.gamme.controle</field>
            <field name="arch" type="xml">
                <form string="Contrôle">
                    <sheet>
                        <group>
                            <field name="doc_gamme_id"/>
                            <field name="intitule_controle"/>
                            <field name="tolerance_mini"/>
                            <field name="tolerance_maxi"/>
                        </group>
                    </sheet>
                </form>
            </field>
        </record>


        <!-- <record id="is_ctrl_rcp_gamme_action" model="ir.actions.act_window">
            <field name="name">Gamme Contrôle Réception</field>
            <field name="res_model">is.ctrl.rcp.gamme</field>
            <field name="view_mode">tree,form</field>
            <field name="search_view_id" ref="is_ctrl_rcp_gamme_search_view"/>
            <field name="context">{}</field>
        </record> -->
        <record id="is_ctrl_rcp_rapport_tree_view" model="ir.ui.view">
            <field name="name">is_ctrl_rcp_rapport_tree_view</field>
            <field name="model">is.ctrl.rcp.rapport</field>
            <field name="arch" type="xml">
                <tree>
                    <field name="num_rapport" optional="show"/>
                    <field name="site_id" optional="show"/>
                    <field name="reception_id" optional="show" widget="many2one_clickable"/>
                    <field name="num_reception" optional="hide"/>
                    <field name="codepg" optional="show"/>
                    <field name="designation" optional="show"/>
                    <field name="moule" optional="show"/>
                    <field name="fournisseur_id" optional="show" widget="many2one_clickable"/>
                    <field name="fournisseur" optional="hide"/>
                    <field name="code_fournisseur" optional="hide"/>
                    <field name="qt_annonce" optional="hide"/>
                    <field name="qt_recue" optional="hide"/>
                    <field name="num_lot_fourn" optional="hide"/>
                    <field name="date_rcp" optional="hide"/>
                    <field name="num_bl" optional="hide"/>
                    <field name="num_lot_of" optional="hide"/>
                    <field name="date_ctrl" optional="hide"/>
                    <field name="gamme_id" optional="hide" widget="many2one_clickable"/>
                    <field 
                        name="condi_resultat" optional="show" widget="badge" 
                        decoration-success="condi_resultat=='Conforme'"
                        decoration-warning="condi_resultat=='Non conforme'"
                    />
                    <field 
                        name="conform_resultat" optional="show" widget="badge" 
                        decoration-success="conform_resultat=='Conforme'"
                        decoration-warning="conform_resultat=='Non conforme'"
                    />
                    <field 
                        name="decision_rcp" optional="show" widget="badge" 
                        decoration-success="decision_rcp=='Livraison acceptée'"
                        decoration-warning="decision_rcp=='Livraison dérogée'"
                        decoration-danger="decision_rcp=='Livraison refusée'"
                    />
                    <field name="commentaire" optional="hide"/>
                    <button 
                        title="Dynacase" name="lien_vers_dynacase_action" type="object" icon="fa-file" 
                        attrs="{'invisible': [('dynacase_id', '=', 0)]}"
                        groups="base.group_system"
                    />
                    <field name="dynacase_id" optional="hide" groups="base.group_system"/>
                    <field name="create_date" optional="hide" string="Créé le"/>
                    <field name="create_uid"  optional="hide" string="Créé par"/>
                    <field name="write_date"  optional="hide" string="Modifié le"/>
                    <field name="write_uid"   optional="hide" string="Modifié par"/>
                </tree>
            </field>
        </record>
        <record id="is_ctrl_rcp_rapport_form_view" model="ir.ui.view">
            <field name="name">is_ctrl_rcp_rapport_form_view</field>
            <field name="model">is.ctrl.rcp.rapport</field>
            <field name="arch" type="xml">
                <form string="Rapport Contrôle Réception">
                    <header>
                        <field name="dynacase_id" invisible="1"/>
                        <button 
                            string="Dynacase" name="lien_vers_dynacase_action"
                            type="object" class="btn btn-info"
                            attrs="{'invisible': [('dynacase_id', '=', 0)]}"
                            groups="base.group_system"
                        />
                    </header>
                    <sheet>
                        <field name="active" invisible="1"/>
                        <widget name="web_ribbon" title="Archivé" bg_color="bg-danger" attrs="{'invisible': [('active', '=', True)]}"/>
                        <group string="Identification">
                            <group>
                                <field name="num_rapport"/>
                                <field name="site_id"/>
                                <field name="reception_id" required="1"/>
                                <field name="num_reception"  force_save="1" readonly="1"/>
                                <field name="fournisseur_id" required="1"/>
                                <field name="fournisseur" force_save="1" readonly="1"/>
                                <field name="code_fournisseur" force_save="1" readonly="1"/>
                            </group>
                            <group>
                                <field name="codepg" force_save="1" readonly="1"/>
                                <field name="designation" force_save="1" readonly="1"/>
                                <field name="moule" force_save="1" readonly="1"/>
                                <field name="qt_annonce" force_save="1" readonly="1"/>
                                <field name="qt_recue" force_save="1" readonly="1"/>
                                <field name="num_lot_fourn" force_save="1" readonly="1"/>
                                <field name="date_rcp" force_save="1" readonly="1"/>
                                <field name="num_bl" force_save="1" readonly="1"/>
                                <field name="num_lot_of" force_save="1" readonly="1"/>
                            </group>
                        </group>
                        <group string="Contrôle">
                            <group>
                                <field name="date_ctrl" required="1"/>
                                <field 
                                    name="gamme_id" 
                                    attrs="{'readonly': [('saisie_ids', '!=', [])]}" required="1" force_save="1"
                                    domain="[('gamme_controle','=',1)]"
                                />
                            </group>
                        </group>
                        <group string="Résultats" attrs="{'invisible': [('gamme_id', '=', False)]}">
                            <group>
                                <field name="condi_resultat"/>
                                <field name="conform_resultat"/>
                            </group>
                        </group>
                        <group  attrs="{'invisible': [('saisie_ids', '=', [])]}">
                            <field name="saisie_ids" nolabel="1" colspan="2" force_save="1" readonly="1">
                                <tree>
                                    <button 
                                        title="Ouvrir la fiche complète" 
                                        name="ouvrir_fiche_saisie_action" 
                                        type="object" 
                                        icon="fa-search-plus" 
                                        class="btn-link"
                                    />
                                    <field name="rapport_lig"/>
                                    <field name="controle_a_effectuer"/>
                                    <field name="tolerance_mini"/>
                                    <field name="tolerance_maxi"/>
                                    <field name="resultat_display"/>
                                </tree>
                            </field>
                        </group>
                        <group attrs="{'invisible': [('gamme_id', '=', False)]}">
                            <group>
                                <field name="decision_rcp"/>
                            </group>
                        </group>
                        <group attrs="{'invisible': [('gamme_id', '=', False)]}">
                            <field name="commentaire"/>
                        </group>
                         <group string="Pièces jointes" attrs="{'invisible': [('gamme_id', '=', False)]}">
                            <field name="piece_jointe_ids" widget="many2many_binary" nolabel="1" colspan="2"/>
                        </group>
                    </sheet>
                    <div class="oe_chatter">
                        <field name="message_follower_ids"/>
                        <field name="activity_ids"/>
                        <field name="message_ids"/>
                    </div>
                </form>
            </field>
        </record>
        <record id="is_ctrl_rcp_rapport_search_view" model="ir.ui.view">
            <field name="name">is_ctrl_rcp_rapport_search_view</field>
            <field name="model">is.ctrl.rcp.rapport</field>
            <field name="arch" type="xml">
                <search>
                    <field name="num_rapport"/>
                    <field name="site_id"/>
                    <field name="reception_id"/>
                    <field name="codepg"/>
                    <field name="fournisseur_id"/>
                    <field name="date_rcp"/>
                    <field name="date_ctrl"/>
                    <field name="decision_rcp"/>
                </search>
            </field>
        </record>
        <record id="is_ctrl_rcp_rapport_action" model="ir.actions.act_window">
            <field name="name">Rapports RCP</field>
            <field name="res_model">is.ctrl.rcp.rapport</field>
            <field name="view_mode">tree,form</field>
            <field name="search_view_id" ref="is_ctrl_rcp_rapport_search_view"/>
            <field name="context">{}</field>
        </record>


        <!-- is.ctrl.rcp.saisie -->
        <record id="is_ctrl_rcp_saisie_tree_view" model="ir.ui.view">
            <field name="name">is_ctrl_rcp_saisie_tree_view</field>
            <field name="model">is.ctrl.rcp.saisie</field>
            <field name="arch" type="xml">
                <tree>
                    <field name="site_id" optional="show"/>
                    <field name="rapport_id" optional="show" widget="many2one_clickable"/>
                    <field name="date_ctrl" optional="show"/>
                    <field name="reception_id" optional="show" widget="many2one_clickable"/>
                    <field name="num_reception" optional="hide"/>
                    <field name="fournisseur_id" optional="show" widget="many2one_clickable"/>
                    <field name="fournisseur" optional="hide"/>
                    <field name="code_fournisseur" optional="hide"/>
                    <field name="codepg" optional="show"/>
                    <field name="designation" optional="show"/>
                    <field name="moule" optional="show"/>
                    <field name="num_lot_fourn" optional="hide"/>
                    <field name="rapport_lig" optional="show"/>
                    <field name="controle_a_effectuer" optional="show"/>
                    <field name="tolerance_mini" optional="show"/>
                    <field name="tolerance_maxi" optional="show"/>
                    <field name="resultat_display" optional="show"/>
                    <button 
                        title="Dynacase" name="lien_vers_dynacase_action" type="object" icon="fa-file" 
                        attrs="{'invisible': [('dynacase_id', '=', 0)]}"
                        groups="base.group_system"
                    />
                    <field name="dynacase_id" optional="hide" groups="base.group_system"/>
                    <field name="create_date" optional="hide" string="Créé le"/>
                    <field name="create_uid"  optional="hide" string="Créé par"/>
                    <field name="write_date"  optional="hide" string="Modifié le"/>
                    <field name="write_uid"   optional="hide" string="Modifié par"/>
                </tree>
            </field>
        </record>
        <record id="is_ctrl_rcp_saisie_form_view" model="ir.ui.view">
            <field name="name">is_ctrl_rcp_saisie_form_view</field>
            <field name="model">is.ctrl.rcp.saisie</field>
            <field name="arch" type="xml">
                <form string="Saisie Contrôle Réception">
                    <header>
                        <field name="dynacase_id" invisible="1"/>
                        <button 
                            string="Dynacase" name="lien_vers_dynacase_action"
                            type="object" class="btn btn-info"
                            attrs="{'invisible': [('dynacase_id', '=', 0)]}"
                            groups="base.group_system"
                        />
                    </header>
                    <sheet>
                        <field name="active" invisible="1"/>
                        <widget name="web_ribbon" title="Archivé" bg_color="bg-danger" attrs="{'invisible': [('active', '=', True)]}"/>
                        <group string="Identification">
                            <group>
                                <field name="site_id"/>
                                <field name="rapport_id" readonly="1"/>
                                <field name="reception_id"/>
                                <field name="fournisseur_id"/>
                            </group>
                            <group>
                                <field name="date_ctrl"/>
                                <field name="codepg"/>
                                <field name="designation"/>
                                <field name="moule"/>
                                <field name="num_lot_fourn"/>
                            </group>
                        </group>
                        <group string="Détails de contrôle">
                            <group>
                                <field name="rapport_lig" readonly="1"/>
                                <field name="controle_a_effectuer" readonly="1"/>
                             </group>
                            <group>
                                <field name="tolerance_mini"   readonly="1"/>
                                <field name="tolerance_maxi"   readonly="1"/>
                            </group>
                        </group>
                        <group string="Mesures">
                            <button 
                                string="Créer 20 mesures" 
                                name="creer_20_mesures_action" 
                                type="object" 
                                class="btn btn-primary"
                                icon="fa-plus"
                                attrs="{'invisible': [('mesure_ids', '!=', [])]}"
                                colspan="2"
                            />
                            <field name="mesure_ids" context="{'default_saisie_id': active_id}" nolabel="1" colspan="2" attrs="{'invisible': [('mesure_ids', '=', [])]}">
                                <tree editable="bottom" create="false" delete="false">
                                    <field name="num_mesure" readonly="1"/>
                                    <field name="valeur_mesuree"/>
                                    <field name="valeur_resultat_display"/>
                                </tree>
                            </field>
                        </group>
                        <group attrs="{'invisible': [('mesure_ids', '=', [])]}">
                           <group>
                                <field name="resultat_display" readonly="1"/>
                            </group>
                        </group>
                    </sheet>
                    <div class="oe_chatter">
                        <field name="message_follower_ids"/>
                        <field name="activity_ids"/>
                        <field name="message_ids"/>
                    </div>
                </form>
            </field>
        </record>
        <record id="is_ctrl_rcp_saisie_search_view" model="ir.ui.view">
            <field name="name">is_ctrl_rcp_saisie_search_view</field>
            <field name="model">is.ctrl.rcp.saisie</field>
            <field name="arch" type="xml">
                <search>
                    <field name="site_id"/>
                    <field name="rapport_id"/>
                    <field name="reception_id"/>
                    <field name="date_ctrl"/>
                    <field name="fournisseur_id"/>
               </search>
            </field>
        </record>
        <record id="is_ctrl_rcp_saisie_action" model="ir.actions.act_window">
            <field name="name">Saisies RCP</field>
            <field name="res_model">is.ctrl.rcp.saisie</field>
            <field name="view_mode">tree,form</field>
            <field name="search_view_id" ref="is_ctrl_rcp_saisie_search_view"/>
            <field name="context">{}</field>
        </record>
    </data>
</odoo>
